<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Generator with Gemini</title>
  <style>
    
      #intro {
      background-image: url(assets/img/coverimg.png);
      height: 100vh;
    }

    /* Height for devices larger than 576px */
    @media (min-width: 992px) {
      #intro {
        margin-top: -58.59px;
      }
    }

    .navbar .nav-link {
      color: #fff !important;
    }

    /* Style for the text box */
    #user-prompt {
      width: 100%;
      padding: 15px;
      margin-bottom: 20px;
      border: 2px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box; /* Ensure padding and border are included in the width */
      font-size: 18px;
      resize: vertical; /* Allow vertical resizing */
      min-height: 150px; /* Set a minimum height */
    }

    /* Style for the generate button */
    #generate-button {
      background-color: #4CAF50;
      color: white;
      padding: 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 18px;
      transition: background-color 0.3s ease; /* Add a smooth transition */
    }

    /* Change button color on hover */
    #generate-button:hover {
      background-color: #45a049;
    }

    /* Style for the response paragraph */
    #response {
      margin-top: 20px;
    }

    /* Style for the status message paragraph */
    #statusMessage {
      margin-top: 20px;
    }

    
  </style>
</head>
<body>
  <h1>Ask me anything!</h1>
  <textarea id="user-prompt" placeholder="Enter your generative prompt here..."></textarea>
  <button id="generate-button">Generate Image</button>
  <div id="imageContainer" style="width: 500px; height: 500px;"></div>
  <p id="response"></p>
  <p id="statusMessage"></p>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // Securely access your API key (replace with your actual key and implementation)
    const API_KEY = "AIzaSyBGngRN-stYF9VdsSFBcv179w3LcVx3-ss"; // Example using Vite config

    async function generateText() {
      const userPrompt = document.getElementById("user-prompt").value;
      const responseElement = document.getElementById("response");

      if (!userPrompt) {
        responseElement.textContent = "Please enter a generative prompt.";
        return;
      }

      // Ensure prompt is not more than 35 words
      const words = userPrompt.split(" ");
      if (words.length > 35) {
        responseElement.textContent = "The prompt should not exceed 35 words.";
        return;
      }

      // Constructing the prompt with correct structure
      const prompt_g = `i'm working on a generative ai model where we give textual prompt and the model generates appropriate image as output. our objective is to enhance the designs of products (can be t-shirts, stationaries, shoes, logos etc) of companies or startups or small business men which will help them to develop their business. Modify and give proper structure to the prompt given by the user. The prompt given by user is:${userPrompt} (return only the correct prompt. nothing else) [this is just an example prompt format that generated an image -"half body,cinematic film still, a cat mage, armor, wrathful eyes,  dark atmosphere, shallow depth of field, vignette, highly detailed, high budget, bokeh, cinemascope, moody, epic"] generate the prompt in a similar structure as that of the example prompt provided. `;
      let prompt_img;
      try {
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-pro" });
        const response = await model.generateContent(prompt_g);
        console.log(response);

        // Access the text content from the response object
        const generatedText = response.response.text();
        responseElement.textContent = generatedText;
        prompt_img=generatedText;
        console.log(generatedText);

      } catch (error) {
        console.error("Error generating text:", error);
        responseElement.textContent = "An error occurred. Please try again.";
      }

      const api_key = "SG_16a315906dbd1da0";
            const url = "https://api.segmind.com/v1/sdxl1.0-colossus-lightning";

            // Get the prompt from the input field
            

            const data = {
                "prompt": prompt_img,
                "negative_prompt": "((close up)),(octane render, render, drawing, bad photo, bad photography:1.3), (worst quality, low quality, blurry:1.2), (bad teeth, deformed teeth, deformed lips), (bad anatomy, bad proportions:1.1), (deformed iris, deformed pupils), (deformed eyes, bad eyes), (deformed face, ugly face, bad face), (deformed hands, bad hands, fused fingers), morbid, mutilated, mutation, disfigured",
                "samples": 1,
                "scheduler": "DPM++ SDE",
                "num_inference_steps": 9,
                "guidance_scale": 1,
                "seed": 902448,
                "img_width": 1024,
                "img_height": 1024,
                "base64": true // Request image in base64 format
            };
            console.log("before response from img");
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': api_key
                    },
                    body: JSON.stringify(data)
                });
                console.log("after response from img");

                if (response.ok) {
                    console.log("response ok");
                    const responseData = await response.json();
                    const imageData = responseData.image;

                    // Create a new Image element
                    const image = new Image();

                    // Set its src attribute to the Base64 data URL
                    image.src = 'data:image/png;base64,' + imageData;
                    console.log(image.src);

                    // Set the width and height of the image
                    image.width = 500;
                    image.height = 500;
                    console.log("img generated");

                    // Append the image to the imageContainer div
                    const imageContainer = document.getElementById('imageContainer');
                    imageContainer.innerHTML = ''; // Clear previous image
                    imageContainer.appendChild(image);
                    
                    document.getElementById('statusMessage').textContent = 'Image generated successfully.';
                } else {
                    console.log("response not ok");
                    document.getElementById('statusMessage').textContent = 'Failed to generate image. Please try again later.';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('statusMessage').textContent = 'Error: ' + error.message;
            }

    }

    document.getElementById("generate-button").addEventListener("click", generateText);
  </script>
</body>
</html>